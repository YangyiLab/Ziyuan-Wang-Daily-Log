- [2021-8-1](#2021-8-1)
  - [PLAN](#plan)
  - [phage 统计](#phage-统计)
  - [UIUC LAB](#uiuc-lab)
- [2021-8-2](#2021-8-2)
  - [PLAN](#plan-1)
  - [NTU LAB](#ntu-lab)
  - [群体遗传-固定系数](#群体遗传-固定系数)
    - [三种衡量](#三种衡量)
    - [Wahlund效应](#wahlund效应)
- [2021-8-3](#2021-8-3)
  - [PLAN](#plan-2)
  - [群体遗传--群体结构理想化模型](#群体遗传--群体结构理想化模型)
    - [大陆海岛模型](#大陆海岛模型)
    - [海岛海岛模型](#海岛海岛模型)
    - [无限海岛模型](#无限海岛模型)
    - [溯祖与亚群、前夕的关系](#溯祖与亚群前夕的关系)
- [2021-8-3](#2021-8-3-1)
  - [PLAN](#plan-3)
  - [Quite good LAB](#quite-good-lab)
  - [统计单链双链phage](#统计单链双链phage)
    - [gc skew](#gc-skew)
  - [the dataset](#the-dataset)
  - [群体遗传-突变](#群体遗传-突变)
    - [突变来源](#突变来源)
    - [基本概念](#基本概念)
  - [Pytorch 线性回归](#pytorch-线性回归)
- [2021-8-5](#2021-8-5)
  - [PLAN](#plan-4)
  - [群体遗传4-突变的结局](#群体遗传4-突变的结局)
    - [孟德尔分离](#孟德尔分离)
    - [突变在有限群体模型中的结局](#突变在有限群体模型中的结局)
    - [自然选择下的几何模型](#自然选择下的几何模型)
  - [Demography LAB](#demography-lab)
- [2021-8-6](#2021-8-6)
  - [PLAN](#plan-5)
  - [NUS LAB](#nus-lab)
  - [Boosting](#boosting)
- [2021-8-7](#2021-8-7)
  - [PLAN](#plan-6)
  - [群体遗传--突变模型](#群体遗传--突变模型)
    - [等位基因突变模型](#等位基因突变模型)
    - [DNA序列的突变模型](#dna序列的突变模型)
    - [突变对等位基因频率的影响](#突变对等位基因频率的影响)
- [2021-8-8](#2021-8-8)
  - [PLAN](#plan-7)
  - [决策树python实现](#决策树python实现)
  - [pytorch 流程 用三次方拟合sin](#pytorch-流程-用三次方拟合sin)
- [2021-8-9](#2021-8-9)
  - [PLAN](#plan-8)
  - [群体遗传--自然选择](#群体遗传--自然选择)
    - [适应度](#适应度)
    - [自然选择对不同表达方式基因所产生的作用](#自然选择对不同表达方式基因所产生的作用)
    - [自然选择增加平均适应性(等位基因频率和适应性关系)](#自然选择增加平均适应性等位基因频率和适应性关系)
    - [自然选择的基本定理](#自然选择的基本定理)
- [2021-8-10](#2021-8-10)
  - [PLAN](#plan-9)
  - [pytorch Dataset&loader 类构建](#pytorch-datasetloader-类构建)
    - [声明自己的dataset](#声明自己的dataset)
    - [导入到Dataloader](#导入到dataloader)
  - [softmax classifier for phage](#softmax-classifier-for-phage)
- [2021-8-11](#2021-8-11)
  - [PLAN](#plan-10)
  - [Wilson Lab](#wilson-lab)
    - [batch effects](#batch-effects)
  - [群体遗传-自然选择模型](#群体遗传-自然选择模型)
    - [基因型适应性表面模型](#基因型适应性表面模型)
    - [单位点三位基因模型](#单位点三位基因模型)
    - [两位点模型](#两位点模型)
    - [自然选择与突变，漂变影响](#自然选择与突变漂变影响)
- [2021-8-12](#2021-8-12)
  - [PLAN](#plan-11)
  - [phage 数据集](#phage-数据集)
- [2021-8-13](#2021-8-13)
  - [PLAN](#plan-12)
- [2021-8-14](#2021-8-14)
  - [PLAN](#plan-13)
  - [群体遗传--分子进化](#群体遗传--分子进化)
    - [中性理论](#中性理论)
    - [多态性](#多态性)
    - [分化](#分化)
    - [近中性理论](#近中性理论)
  - [机器学习SVM](#机器学习svm)
  - [质谱数据处理流程](#质谱数据处理流程)
- [2021-8-15](#2021-8-15)
  - [PLAN](#plan-14)
  - [GitHub令牌](#github令牌)
  - [群体遗传--分子中性衡量](#群体遗传--分子中性衡量)
    - [SNP](#snp)
    - [分子时钟](#分子时钟)
    - [分子时钟的验证](#分子时钟的验证)
    - [进化率不同的原因](#进化率不同的原因)
- [2021-8-16](#2021-8-16)
  - [PLAN](#plan-15)
  - [UCLA LAB](#ucla-lab)
- [2021-8-17](#2021-8-17)
  - [PLAN](#plan-16)
  - [群体遗传--分子进化2](#群体遗传--分子进化2)
    - [HKA检验](#hka检验)
    - [MK检验](#mk检验)
    - [Tajima's D](#tajimas-d)
    - [mismatch distribution](#mismatch-distribution)
    - [关联位点](#关联位点)
  - [phage](#phage)
- [2018-8-18](#2018-8-18)
  - [PLAN](#plan-17)
  - [SVM总结](#svm总结)
  - [群体遗传part](#群体遗传part)
- [2018-8-19](#2018-8-19)
  - [PLAN](#plan-18)
  - [500-bp phage result](#500-bp-phage-result)
    - [random forest](#random-forest)
    - [deep learning](#deep-learning)
  - [Gaoxin ARG论文](#gaoxin-arg论文)
  - [群体遗传中最关键的描述因素](#群体遗传中最关键的描述因素)
    - [$H$ $F$ and $H_e$](#h-f-and-h_e)
    - [配子不平衡](#配子不平衡)
- [2018-8-20](#2018-8-20)
  - [PLAN](#plan-19)
  - [NTU Lab](#ntu-lab-1)
  - [QTL初步](#qtl初步)
  - [群体遗传回顾](#群体遗传回顾)
# 2021-8-1
## PLAN
+ **GRE 填空2阅读2**
+ **收集双链phage序列并初步统计**
+ **修改abstract graphic**
## phage 统计
+ length

**Double Strand linear >>Single Strand circular**
+ gc_content
+ gc_skew
+ rbs_distribution/number

28 features
"GGAGGA" dominant

## UIUC LAB
https://www.sinhalab.net/people

# 2021-8-2
## PLAN
+ **GRE 填空2阅读2**
+ **西瓜书chapter1 2 3**
+ **abstract graphic定稿**
+ **群体遗传3**
+ **Cover Letter**

## NTU LAB
https://www.yqiaolab.com/research
https://gohwils.github.io/biodatascience/
https://dr.ntu.edu.sg/cris/rp/rp00715?ST_EMAILID=ZHAOYAN&CategoryDescription=BiomedicalSciencesLifeSciences
https://www.scelse.sg/People/Detail/5dcdf536-2f65-498b-84bd-c4edb768d659
https://swuertzlab.com/people2/
http://compbio.case.edu/koyuturk/index.html

## 群体遗传-固定系数
[Last section](July.md)
### 三种衡量
+ 观测平均杂合子$H_I$ 每一个亚群观测杂合频率平均
+ 预期平均杂合子$H_S$ 每个亚群杂合子期望再平均
+ 全群体杂合子 $H_T= 2\bar{p}\bar{q}$

### Wahlund效应

Wahlund效应：由于种群结构的存在，造成的分群预期平均杂合子频数比全群体预期杂合子数低的现象，即Ht>Hs。
$e.g.$ 人类很多隐性遗传病往往在孤立群体中发生率较高，而在经历较大基因流的群体中，杂合子频率升高，隐性遗传病发生概率较低。

按照Hardy-Weinberg法则估算的整个群体中纯合体的频率比各地方群体中的纯合体频率的平均值要低。

由于$p_i,q_i$不相等所以会导致这个现象

Fis衡量由于**亚群内**非随机交配造成的杂合子频数观测值和预期值的差异。
Fst衡量由于[种群结构](https://gitee.com/YangyiLab/Daily-Worklog/blob/master/July.md#%E7%BE%A4%E4%BD%93%E9%81%97%E4%BC%A0-%E7%BE%A4%E4%BD%93%E7%BB%93%E6%9E%84%E5%92%8C%E5%9F%BA%E5%9B%A0%E6%B5%81)的存在而造成的杂合子频数的降低。 **由于基因流有限，造成等位基因频率在群体中分布存在异质性**
Fit同时衡量了亚群内非随机交配和种群结构导致的杂合子频数的变异。

$$F_{st}=\frac{H_T-H_S}{H_T}$$
Fst是经常用来衡量种群结构和种群分化的参数
# 2021-8-3
## PLAN
+ **完成sbb投稿**
+ **GRE填空2阅读2**
+ **群体遗传3**
+ **西瓜书chapter 3**

## 群体遗传--群体结构理想化模型
### 大陆海岛模型
![大陆海岛图示](https://pic1.zhimg.com/80/v2-52f578ecd9ff778e0d4fcc2f96a2b0c8_720w.jpg)
假设:
+ 大陆足够大
+ 短期迁徙可以忽略
+ 海岛上每一代有m比例个体来自大陆，1-m比例个体来自海岛本身。
+ 无遗传漂变、无自然选择、无突变、随机交配、迁徙基因型来自随机样本。

**基于等式**
$$p_{t=1}^{island}-p_{t=0}^{island}=-m(p_{t=0}^{island}-p^{continent})$$
**递推公式**
$$p_{t}^{island}=p^{continent}+(1-m)^t(p_{t=0}^{island}-p^{continent})$$
$${\lim_{t \to + \infin}}p_t^{island}=p^{continnent}$$
结论
迁徙率决定了到达平衡状态的时间长短，与初始基因频率差异无关。

### 海岛海岛模型
本模型假设了种群迁徙对两个海岛的等位基因频率都产生影响。此模型下，两个海岛的等位基因频率最终会变得相同，达到平衡状态。

$${\bar{p}}=\frac{p_1m_2+p_2m_1}{m_1+m_2}$$
平衡状态频率更加接近于迁徙（入）率小的海岛的初始频率。

### 无限海岛模型
**当各个亚群之间有足够的基因流时（即各个亚群可以很好的混合），Ht和Hs是相等的，即Fst=0。**
当m=0，即没有基因流时，经过时间t之后，整个大群体的群体分化$F_{st}$指数分布 在遗传漂变的作用下，等位基因频率在各个海岛上要么固定，要么丢失。

单个种群中基因频率不变，杂合子频率逐渐减少$H_T$定值

$H_t= (1-\frac{1}{2N_e})^tH_0$ 表示单个种群杂合子频率降低

$$F_{st}=\frac{H_T-H_S}{H_T}$$
利用$N_e$进行估计，平衡值$F_{st}=\frac{1}{1+4N_em},N_e>>m$
FST取值范围[0,1],最大值为1，表明等位基因在各地方群体中固定，完全分化；
最小值为0，意味着不同地方群体遗传结构完全一致，群体间没有分化。
**上述模型是无限海岛模型，也就是等位基因频率不会在整个大群体得到固定或者丢失。**

Wright建议，实际研究中，FST为0～0.05:群体间遗传分化很小，可以不考虑；
FST为0.05～0.15，群体间存在中等程度的遗传分化；
FST为0.15~0.25，群体间遗传分化较大；
FST为0.25以上，群体间有很大的遗传分化。
### 溯祖与亚群、前夕的关系
当两个亚群之间迁徙率很低时（左图），溯祖往往在各个谱系先发生，然后再迁徙；当迁徙率很高时，分支可能在各个亚群之间频繁移动，一个分支的溯祖可能发生在另一亚群中

![迁徙与溯祖](https://pic1.zhimg.com/80/v2-d2bc90d0e1fbd4b025561e445437dba0_720w.jpg)

回顾溯祖所需时间:
+ 双样本溯祖所需时间为$2N_e$
+ 多个个题素组时间比较短

**含有迁移的溯祖**
来自同一个亚群的两个分支溯祖时间长短不受种群迁徙率的影响，只和大群体种群数量有关，数量越大，溯祖所需时间越长。
当两个分支来自两个不同亚群时，溯祖时间不仅受大群体数量影响，还受迁徙率影响。迁徙率越大，溯祖时间越短。

# 2021-8-3
## PLAN
+ **统计单链双链phage**
+ **GRE填空2阅读2**
+ **群体遗传4**
+ **西瓜书chapter 3代码在pytorch实现**

## Quite good LAB
+ http://blekhmanlab.org/research.html

## 统计单链双链phage
### gc skew
GC skew is when the nucleotides guanine and cytosine are over- or under-abundant in a particular region of DNA or RNA. In equilibrium conditions (without mutational or selective pressure and with nucleotides randomly distributed within the genome) there is an equal frequency of the four DNA bases (adenine, guanine, thymine, and cytosine) on both single strands of a DNA molecule.

## the dataset
Code
```python
import pyfastx
import numpy
import matplotlib.pyplot as mplt
import phanotate_modules.functions as phano
fa_ds = pyfastx.Fasta('ds-linear.fasta')
fa_ss = pyfastx.Fasta('ss-circular.fasta')
dataset=[]
for itm in fa_ds:
  list_itm=[]
  list_itm.append(len(itm.seq))
  list_itm.append(itm.gc_skew)
  list_itm.append(itm.gc_content)
  brbs=phano.get_backgroud_rbs(itm.seq)
  list_itm=list_itm+brbs
  list_itm.append("ds")
  dataset.append(list_itm)

for itm in fa_ss:
  list_itm=[]
  list_itm.append(len(itm.seq))
  list_itm.append(itm.gc_skew)
  list_itm.append(itm.gc_content)
  brbs=phano.get_backgroud_rbs(itm.seq)
  list_itm=list_itm+brbs
  list_itm.append("ss")
  dataset.append(list_itm)
```

Entity = ["length","gc_skew","gc_content","rbs1_content","rbs2_content"..."rbs28_content"]

## 群体遗传-突变
### 突变来源
+ 点突变
+ 插入缺失突变
+ 结构变异

中性突变--受drift 影响
有利有害--受自然选择影响
### 基本概念
+ **mutation fitness spectrum** 遗传适应谱系

一个密度分布函数图，表现了一个突变对于物种的有益或者有害
![mutation fitness spectrum](https://pic4.zhimg.com/80/v2-fb05a9def37b14077cf10b20f91f0187_720w.jpg)
+ mutation-accumulation 突变累积实验

用途:估计突变适应谱。估计多代后做突变处理的组和对照组的适应度变化和基因型的方差确定是否有利突变
## Pytorch 线性回归
步骤 
+ 定义一组输入数据；
+ 定义计算图；
+ 定义损失函数；
+ 优化，拟合参数。

# 2021-8-5
## PLAN
+ **GRE阅读2填空2**
+ **tensorflow简单做降维**
+ **西瓜书第四章**
+ **群体遗传4**

## 群体遗传4-突变的结局
### 孟德尔分离
在突变二倍体中，有1/2的可能传递给子代，有1/2的可能丢失。如果有k个子代，那么该突变在所有子代中丢失的概率
$$P(mutationlost)=(\frac{1}{2})^k$$
对于一个群体，如果子代数量为Poisson分布，那么该群体经过一代之后，该（中性）突变在群体中丢失的概率是一个常数1/e = 0.3679
推导方法: 对K求全概率，K服从$\lambda=2$的泊松分布，原因，种群数量不变。

### 突变在有限群体模型中的结局
初始频率$p_0=1/N_e$ $p_0\rightarrow `
0$ 由扩散模型，扩散时间$4N_e$ 固定概率$1/2N_e$

### 自然选择下的几何模型
微突变：被自然选择固定的有利突变往往是微小作用的突变，而不是带来很大效应的突变。

**原因如图所示**

![](https://pic3.zhimg.com/80/v2-a667f1b8d85b4d548f2a158c1db38e82_720w.jpg)
靠近圆心则为有利突变

![](https://pic2.zhimg.com/80/v2-50d587bdb7b41075f7afaaa99e7d8e6d_720w.jpg)

m(突变强度，如突变设计的等位基因数)较小时，突变靠近有利变异的可能性较大。

**考虑drift时** m越小，drift的固定作用比较弱而自然选择作用又比较小，有利突变易丢失

## Demography LAB
+ https://www.med.upenn.edu/mathieson-lab/personnel.html
+ https://lohmueller.eeb.ucla.edu/research/
+ http://jjensenlab.org/people
+ https://popgen.gatech.edu/people/

# 2021-8-6
## PLAN
+ **GRE阅读2填空1**
+ 群体遗传4
+ **西瓜书chapter 4 和boosting**
+ **统计phage，给出统计学信息**

## NUS LAB
+ duke-nus.edu.sg/eid/faculty/tenure-track-faculty/tenure-track-faculty-staff-details/Detail/gavin-james-smith
+ https://www.duke-nus.edu.sg/cvmd/the-team/primary-appointment/Detail/owen-john-llewellyn-rackham
+ https://avianevonus.com/lab-members/

## Boosting
Core 给予每一个obs一个权重$w_i$
迭代依据
$$\alpha^{(s)}=log\frac{1-err^{(s)}}{err^{(s)}}$$
$$w_i^{(s)}=w_i^{(s-1)}exp(\alpha)^{(s)}$$

# 2021-8-7
## PLAN
+ **GRE套题1**
+ **群体遗传4**

## 群体遗传--突变模型
### 等位基因突变模型

无限等位基因模型：每次突变都产生一个新的从未有过的基因类型，后代中所有该基因型都是通过该突变得到的，identity by descent。

k 等位基因模型：假设某个位点的等位基因不是无限的，而是k个，每次突变都有k-1种可能。随着k的减小和突变率的增大， 群体中出现的两个相同的等位基因越来越有可能是多次突变事件形成的identity by state，而不是同一个突变事件identity by descent。

逐步突变模型：突变产生的基因型取决于当前基因状态，即突变并不是完全随机的。比如，在不同的DNA序列中，SNP突变的转换(CT/AG)比颠换(CA/CG/GT/AT)更容易发生。
(突变作用于状态，状态的衡量就是微卫星DNA片段的多态性，数量多态性，由整数表示the number of repeats)
**对于IBD的解释，两个具有相同repeats number的基因可能不是IBD e.g. 9+1=10-1**

### DNA序列的突变模型

无限位点模型：假设DNA序列无限长，每一个位点都有发生突变的可能，且每个位点最多只能经历一次突变。
**用途：短时间内近似**

有限位点模型：DNA序列长度有限，每个位点可能经历多次突变。

### 突变对等位基因频率的影响
+ 不可逆

$$p_t=p_0(1-\mu)^t$$
+ 可逆 利用马尔科夫性，之和转移概率有关

$P(a\rightarrow A)= \mu, P(A\rightarrow a)= \lambda$
平衡概率$P_{equilibrium}=\frac{\lambda}{\lambda+\mu}$

+ 考虑遗传漂变 计算杂合率 计算方法和migration gene flow 类似 加入因子

平衡$F=\frac{1}{4N_e\mu+1}$
即在一个无限等位基因模型中，在漂变-突变平衡的群体中，两个随机抽样的等位基因是非同源等位基因allozygous的概率。随着theta的增大，两个等位基因来自非同源的可能性增加，而来自同源等位的概率越来越小。
![allozygous](https://dyerlab.github.io/applied_population_genetics/media/allele_lineages.png)

# 2021-8-8
## PLAN
+ **GRE阅读2填空1**
+ **西瓜书chapter 4 sklearn**
+ **修改abstract定稿**

## 决策树python实现
网址 https://sklearn.apachecn.org/docs/master/11.html
示例代码

```python
from sklearn import tree
X = [[0, 0], [1, 1],[1,2]]
Y = [0, 1, 0]
clf = tree.DecisionTreeClassifier()
clf = clf.fit(X, Y)
clf.predict_proba([[2., 2.]])
```

## pytorch 流程 用三次方拟合sin
```python
import numpy as np
import math

# Create random input and output data
x = np.linspace(-math.pi, math.pi, 2000)
y = np.sin(x)

# Randomly initialize weights
a = np.random.randn()
b = np.random.randn()
c = np.random.randn()
d = np.random.randn()

learning_rate = 1e-6
for t in range(2000):
    # Forward pass: compute predicted y
    # y = a + b x + c x^2 + d x^3
    y_pred = a + b * x + c * x ** 2 + d * x ** 3

    # Compute and print loss
    loss = np.square(y_pred - y).sum()
    if t % 100 == 99:
        print(t, loss)

    # Backprop to compute gradients of a, b, c, d with respect to loss
    grad_y_pred = 2.0 * (y_pred - y)
    grad_a = grad_y_pred.sum()
    grad_b = (grad_y_pred * x).sum()
    grad_c = (grad_y_pred * x ** 2).sum()
    grad_d = (grad_y_pred * x ** 3).sum()

    # Update weights
    a -= learning_rate * grad_a
    b -= learning_rate * grad_b
    c -= learning_rate * grad_c
    d -= learning_rate * grad_d

print(f'Result: y = {a} + {b} x + {c} x^2 + {d} x^3')
```

# 2021-8-9
## PLAN
+ **GRE阅读4**
+ **群体遗传5**
+ **西瓜书chapter 5**
+ **修改研究进展ppt**

## 群体遗传--自然选择
### 适应度
相对适应度(相对于B基因)$w=\frac{\lambda_A}{\lambda_B}$
选择系数$s_{xx}=1-w_{xx}$ 选择系数越高，适应性越差
### 自然选择对不同表达方式基因所产生的作用
**基因的表达方式可以概括为5种：隐性(被选择的基因为隐性，且杂合不被选择)、显性(被选择的基因为显性，且杂合不被选择)、一般显性(被选择的基因为显性，且杂合被选择作用会被中和系数h调整而非只是选择系数s)、杂合劣势(纯合子被选择。杂合子相对来说生存优势比较低)、杂合优势(杂合子生存优势高)。**
自然选择过程的特点--基因频率每一代改变，基因型频率服从HW平衡

Tips:
+ Dominance -- 杂合子的屏蔽作用 sheltering effect
+ 一般象形的共显性数 condominance h 0~1 时图像 0对应隐形拮抗 1对应线性拮抗
+ 杂合劣势 只与其实基因频率有关 **起始等位基因频率高于0.5时，该等位基因会得到固定，而低于0.5时，该等位基因会消失。**
+ 杂合优势 

不管起始频率是高于0.5，还是低于0.5，最后该等位基因频率总是趋近于0.5（假设两个纯合子适应性相同）。杂合子的频率在群体中占有多数。

这和前面提到的几种选择作用不同。前面不管是对显性基因的选择，对隐性基因的选择，还是对杂合子劣势，自然选择的结果都是清除群体中的某一个基因，使得群体多态性降低，也称之为单态平衡monomorphic equilibrium。而杂合优势带来的结果是维持了群体的多态性，没有使得其中一个等位基因固定或者消失，所以杂合优势导致的结果也称之为多态平衡polymorphic equilibrium。

+ 杂合优势的计算方法 极限法，当$\Delta p =0$条件计算

### 自然选择增加平均适应性(等位基因频率和适应性关系)
自然选择的结果是增加的群体的平均适应性

显性、隐性一般显性，自然选择趋向于增加平均适应性

杂合优势和杂合劣势的适应性和等位基因频率

![heter](https://pic2.zhimg.com/80/v2-cee559d46be42ba2fdaa0903ce142451_720w.jpg)

自然选择倾向增大平均适应性
在杂合优势时（左图），当两个等位基因频率相同的时候，群体平均适应性最高。此时等位基因频率最稳定，当一个等位基因低于该频率时，自然选择会驱使它回到该频率。

在杂合劣势时（右图），当两个等位基因频率相同的时候，群体平均适应性最低。此时等位基因频率最不稳定，一旦有微小偏离，自然选择会驱使出现更大的偏离。

### 自然选择的基本定理
Fisher通过公式证明了经过一代自然选择，群体平均适应性的改变等于群体适应性方差（变异）的大小。
$$\Delta \bar{w} =var(w)$$
$$\Delta \bar{w} =\frac{\bar{w}'- \bar{w}}{\bar{w}}$$
$\bar{w}$ denotes the average of fitness after the natural selection.
即一个群体的各个个体的适应性变异很大，那么经过自然选择该群体的平均适应性变化同样会很大。

# 2021-8-10
## PLAN
+ **GRE填空4**
+ **西瓜书chapter 5 + pytorch**
+ **phage 分类神经网络初步**
+ **EI投递**

## pytorch Dataset&loader 类构建
### 声明自己的dataset
重点要写出 self 中的元素，这些元素可以`for - each`
写出__get_item__ 方法
定义length
### 导入到Dataloader
直接创建类，利用构造函数

## softmax classifier for phage
```python
import torch
import torch.nn as nn
import numpy as np
import matplotlib.pyplot as plt
from d2l import torch as d2l

# Hyper-parameters
input_size = 1
output_size = 1
num_epochs = 10
learning_rate = 0.05

# Linear regression model
model = nn.Sequential(nn.Flatten(), nn.Linear(26,2))
def init_weights(m):
    if type(m) == nn.Linear:
        nn.init.normal_(m.weight, std=0.01)

model.apply(init_weights)

# Loss and optimizer
loss = nn.CrossEntropyLoss()
trainer = torch.optim.SGD(model.parameters(), lr=learning_rate)  

from torch.utils.data import DataLoader

# Train the model
# d2l.train_ch3(model, x_train, y_train, loss, num_epochs, trainer)
from torch.utils.data import DataLoader
from torch.utils import data
class CustomDataset(data.Dataset):#需要继承data.Dataset
    def __init__(self,x,y):
        # TODO
        # 1. Initialize file path or list of file names.
        self.X=x 
        self.y=y
        self.length=len(self.X)
        pass
    def __getitem__(self, index):
        # TODO
        # 1. Read one data from file (e.g. using numpy.fromfile, PIL.Image.open).
        # 2. Preprocess the data (e.g. torchvision.Transform).
        # 3. Return a data pair (e.g. image and label).
        #这里需要注意的是，第一步：read one data，是一个data
        return self.X[index],self.y[index]
        
    def __len__(self):
        # You should change 0 to the total size of your dataset.
        return self.length

mydataset=CustomDataset(x_train,y_train)
myloader=data.DataLoader(mydataset,batch_size=15)
for X, y in myloader:
    print(X)
d2l.train_ch3(model, myloader, myloader, loss, num_epochs, trainer)
```

rate --> 100% (train and cross validation)
# 2021-8-11
## PLAN
+ **Wilson lab**
+ **群体遗传6**
+ **GRE阅读1填空1**

## Wilson Lab
### batch effects
批次效应（batch effect），表示样品在不同批次中处理和测量产生的与试验期间记录的任何生物变异无关的技术差异。批次效应是高通量试验中常见的变异来源，受日期、环境、处理组、实验人员、试剂、平台等一些非生物因素的影响。
合并分析不同批次的数据时，平常的标准化方法不足以调整批次之间的差异。如果批次效应比较严重，这些差异就会干扰实验结果，我们就不能够判断得到的差异表达的基因是来源于想要研究的因素，还是和批次相关。
批次效应不能被消除，只有尽可能的降低。校正批次效应的目的是，减少批次之间的差异，尽量让多个批次的数据重新组合在一起，这样下游分析就可以只考虑生物学差异因素。

## 群体遗传-自然选择模型
### 基因型适应性表面模型
![](https://pic2.zhimg.com/80/v2-a689424551add63ffe462786ac6e2035_720w.jpg)
任何地点起始时都会向AA处移动:原因，无论在任何一点AA的适应度都会大于Aa,aa
### 单位点三位基因模型
**适应性表**
![适应性表](https://pic3.zhimg.com/80/v2-3be82368995f1c07908ceb5a032b1f32_720w.jpg)
![](https://pic4.zhimg.com/80/v2-ced3ef5cacc1f3a42cc92fade3a48ec7_720w.jpg)
**计算方法**
+ $\bar{w}$ 表示三个基因位点的平均适应度
+ $\bar{w}_A=w_{AA}p+w_{AB}q+w_{AC}r,p+q+r=1$ 表示A基因相关的边缘适应度
+ $\Delta p=p\frac{\bar{w}_A-\bar{w}}{\bar{w}}$ 原因:个体较多，在交配时，服从基于基因型的的HW交配原则

对于图一解释为什么当其实C频率较小时C会消失--natural selection instead of drift
当C的起始频率较高时，在自然选择的作用下，群体平均适应性是逐渐增高，所以上图中3个路径直接移动到C固定的位置。而当C的起始频率较低的时候，群体适应性路径并没有直接移动到C固定的位置，相反，把C在群体中移除了。这主要是因为从C频率较低的位置，移动到C频率较高的位置，群体的适应性并不是一直增高，而是会经历一个适应性低谷。自然选择无法使移动路径跨越适应性低谷。关于此适应性低谷，可以参考上表中各个基因型的适应性大小。因为C的起始频率比较低，所以群体中的C多以杂合形式存在，即AC（0.679）和SC（0.534），而这两种基因型的适应性是低于AS（0.763）的适应性的。所以，C以杂合形式出现在群体中，实际上会导致群体适应性降低的。这也是为什么低频出现的C最终在群体中消失了。强调一点，这儿C的消失并不是因为其起始频率低，在遗传漂变的作用下消失的，而是在自然选择作用下消失的。自然选择作用的不是等位基因，而是基因型。

数学角度计算$\Delta p$时C的边缘平均适应性为$\bar{w}_C=w_{CC}p+w_{AC}q+w_{CS}r,p+q+r=1$ 基因频率p较小导致计算的增长值为负数

### 两位点模型
**自然选择对两个位点的选择会牵涉到配子不平衡问题。此种情况下自然选择的结果取决于自然选择本身和两个位点之间的重组情况，以及群体起始基因型频率。**

**复习配子不平衡**假设存在两个位点A, B。 如果位点间等位基因的组合不是随机的，那么就称这种现象为：连锁不平衡，r重组率。

在这里两位点位于同一个染色体上

最终的结局只与r 重组率有关
+ r较小 $\bar{w}$变化较小，基因频率变化受自然选择中重组基因型的影响小，会走向初始的四种基因型适应性最高处
+ 重组水平r较高时，每一代都会产生重组类型，使得群体平均适应性改变，因而可能使得移动路径偏离。此时，各个等位基因的初始频率就可能决定了各个基因的最终命运。

### 自然选择与突变，漂变影响
+ 遗传漂变 对比$4N_es$与1的关系
+ 突变 考虑2位点突变模型 平衡概率$q=(\frac{\mu}{s})^{\frac{1}{2}}$ 近缘交配会导致群体杂合子比预期少，纯合子多于预期。此时有害突变更容易得到纯合，更容易被自然选择作用，也即增加了自然选择的效能。

# 2021-8-12
## PLAN
+ **修改ppt**
+ **晚上meeting定稿forest文章**
+ Gre阅读1填空3
+ **phage制作数据集**
## phage 数据集
全部的ds ss组都截取到了500bp的片段，识别效果不好

# 2021-8-13
## PLAN
+ **Gre阅读1填空3**
+ **phage新数据集训练**
+ 西瓜书chapter 6
+ **代谢组处理**

# 2021-8-14
## PLAN
+ **群体遗传7**
+ **质谱处理学习**
+ **西瓜书chapter 6学习**
+ **Gre 阅读1填空3**

## 群体遗传--分子进化
### 中性理论
**中性理论**在分子进化中通常被当做是无效检验模型，中性理论认为群体中的大多数的突变很小或几乎没有选择优势或劣势，它们大多都是选择中性的。遗传漂变决定了各个突变在群体中结局，即消失或者固定。

**概念**
**多态性**: polymorphism, 即在一个种群内某个基因位点有两个或多个等位基因。

**分化**: divergence, 两个有共同祖先的完全分离的支系在进化过程中形成的固化遗传差异。

### 多态性
一个新突变进入群体，在群体中固定下来的概率是1/2N，需要经历的时间平均为4N世代；丢失的概率是1-1/2N，丢失所经历的平均时间为 $2\frac{N_e}{N}ln(2N)$ 利用遗传漂变固定平均时间推算 
*Note*: 这里的初始频率是$\frac{1}{N}$没有使用有效群体是结合一个新图百年进入群体，而突变章节是initia了frequency 就是$\frac{1}{N_e}$

利用杂合性描述多态性平衡杂合度$H$ 其中$\mu$变异率
$$H_{eq}=\frac{1}{1+\frac{1}{4_e\mu}}$$

**结论** 突变率越高，有效群体数量越大，群体的多态性越高。

### 分化
在一个群体中的突变发生率为 $2N\mu$，该突变在群体中固定的概率为$1/2N$，所以每一代突变得到固定的数量k（碱基替换率）为$\mu$

碱基替换导致了序列分化，既然替换率和突变率相等，那么两个序列分化率也应该和突变率相等。比如，一个位点的突变率是1e-6(即该位点每代每1e6个配子会有一个突变)，那么平均需要1e6代发生一个替换。这也解释了为什么不同位点的碱基替换率会不同：仅仅是因为位点之间的突变率不同。

### 近中性理论
利用$4N_es$进行衡量
原理 遗传漂变以$1/(2N_e)$的速率固定 自然选择以2s速率清除

**和中性理论有所区别，近中性理论考虑了群体大小的因素，碱基替换率大小取决于群体中近乎中性的突变位点的数量，而一个突变是否是近乎中性的取决于有效群体数量大小和选择压力。所以，对于近中性理论而言，有效群体数量大小是影响序列分化的一个重要因素。**

## 机器学习SVM
core:
+ 二分类问题
+ 找到边界和最大间隔
+ 利用拉格朗日乘数法
+ **SOM 算法**

## 质谱数据处理流程
+ 获得对应物质以及id号或者使用化合物名称
+ 粘贴到网站中直接进行富集分析
+ 使用数据库为药物数据库

# 2021-8-15
## PLAN
+ **完成西瓜书chapter 6学习**
+ **群体遗传7**
+ **Gre套题**
+ **github 修复**
+ **处理质谱数据**

## GitHub令牌
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

## 群体遗传--分子中性衡量
### SNP
对DNA多态性的衡量通常用单核酸位点多态性SNP。

p距离：两个DNA序列不同核酸位点的数量除以总核酸位点数量，有时也用d表示。比如上图中两序列12个碱基，5个分化位点，则,$p=5/12$

为了应对饱和问题 **随着时间的延长，分化速度逐渐下降，并最终停止增大。出现这一问题的原因是碱基重复替换multiple hit。**利用矫正模型进行矫正例如Jukes-Cantor模型

多态性标准**分离位点数S**:比对序列越长，比对序列数量越多，分离位点数会相对越多。

**核酸多样性$p_i$**：也称之为平均配对差异。比如上述4个序列，进行两两比较，分别计算各自的d值，然后将所有d值相加，然后除以了两两比较的次数；最后再除以位点数以矫正位点数量多少的影响。

核酸多样性和突变频率可以用来估计$N_e$

### 分子时钟
序列分化和分子时钟 利用分化程度估计分化时间
分化位点数量和分化时间线性关系

### 分子时钟的验证
核心观点: DNA分化远早于物种分化，利用分子时钟进行的估算物种分化时间其实是DNA序列分化的时间，估计偏大T
![分化图](https://pic3.zhimg.com/80/v2-98681c0f4c5edcbf8971571628eb3d46_720w.jpg)

在支系分化之后，物种分化之前，支系主要表现为物种内的祖系多态性（T时间段内），而物种分化之后，支系表现为分化状态（t时间段内）。正是因为祖系多态性的存在，增大了替换数量的不确定性（方差）。同时从上图也可以看出，我们使用分子时钟推测物种分化时间实际上包含了祖系多态性的存留时间，即我们高估了物种分化的时间。

### 进化率不同的原因
+ 各个序列的突变率不同，从而导致了进化率的差异。但是更可能的原因是突变率相同，但是进化率不同，比如当自然选择存在的时候，不同序列的替换率会存在差异，进而导致进化率的差异。
+ 很多物种突变率相同，其突变率的单位是每碱基每世代，但是物种的世代时间差别很大
+ 代谢率不同导致了进化率的差异。代谢率的差异和突变率有相关性，高代谢率导致高DNA复制，进而产生了更多的突变。更高的代谢率还意味着细胞有氧呼吸产生很多氧自由基，导致DNA损坏。**在近中性理论中，”世代时间效应“应该不明显，因为研究显示群体越大的物种，世代时间越短。群体越大导致分化越慢，世代越短导致分化越快；二者作用相互抵消。$N_e$较大时，固定速率较慢，但是世代时间短**
+ 近中性理论认为一个突变是否是”等效中性“还和其有效群体数量有关，有效群体数量越大，自然选择的辨析度越大，”等效中性“位点越少，因为分化越慢；反之，有效群体数量越小，群体中的大部分（包含弱有害或弱有利）突变可以视为”等效中性“，因而有更多的位点在遗传漂变的作用下随机固定或消失，物种分化越快。

# 2021-8-16
## PLAN
+ **Gre阅读2填空2**
+ **完善ppt讲稿**
+ **审阅投稿前全部文件**
+ 群体遗传7

## UCLA LAB
https://loeslab.dgsom.ucla.edu/pages/team

# 2021-8-17
## PLAN
+ **群体遗传7**
+ Gre阅读2
+ **phage构建训练集-500/1000/2000 一个序列中多取一些训练集**
+ **评估Gao Lab研究**

## 群体遗传--分子进化2
### HKA检验
在中性理论前提下，种内多态性(中内某一位点的丰度度如SNP的核酸多态性)和种间分化都和突变率有关，所以多态性和分化也应该是相关的。如果一个位点的突变率高，那么该位点的多态性应该会很高，同时和其他物种相比，该位点的分化程度也会很高。

检验过程:
+ 选择两个位点，一个中性位点作为参考，一个检验位点
+ 选择两个物种
+ 获得两个物种的多态性和分化指标
+ 计算出$test/reference$和$\pi / k$ ($\pi$是多态性指标 $K$是分化指标)

在中性假设的无效模型中，参考位点和测试位点的多态性/分化($\pi/K$)应该是相同的；同时，种内多态性和分化的的测试位点/参考位点(test/reference)也应该是相同的。如果它们不相同，那么就意味着要拒绝无效假设。

检验解读
![example1](https://pic4.zhimg.com/80/v2-a4645ff90236d7b91b077ecbdbf4368b_720w.jpg)
中性

![example2](https://pic1.zhimg.com/80/v2-34987663827fa88e66461ccc3b83c510_720w.jpg)
Adh基因表现了过高的多态性，所以拒绝中性进化的假设，提示该基因可能受到了平衡选择的作用。

局限性: 5'端仍然可能受到自然选择的作用；其次，种群结构对HKA检验也会产生干扰。

本质$\chi^2$检验

### MK检验
其原理和HKA相似，但不需要参考序列，因为它比较了基因序列中的同义突变synonynous和非同义突变nonsynonymous，实际上同义突变相当于提供了参考作用。

同义突变: 突变后不改变氨基酸产物 如CTA $\rightarrow ctg$ 编码的都是亮氨酸

非同突变义:导致多肽产物的氨基酸序列改变或功能性RNA碱基序列改变的基因突变
**在三联密码子中，96%的第一个碱基突变、100%的第二个碱基突变、30%的第三个碱基突变都是非同义突变，即引起氨基端序列的变异**

### Tajima's D
如果一个种群的有效群体数量保持恒定，同时所有突变选择中性，那么群体的核酸多态性和分离位点数量将近似相等。

**结果:**
+ D=0时则中性
+ 如果 Tajima’s D 值为正，表明存在大量的中等频率的等位基因，这可能是由于群体瓶颈效应，群体结构，或者平衡选择引起的。
+ 当所研究的群体中产生有害突变时，这些突变将受到负向选择的作用在群体中保持较低的频率，低比例的突变有所增加，导致 D 值为负
+ 当群体中一条等位基因受到强烈的正向选择作用时，其附近与之紧密连锁的座位的上变异将伴随这条等位基因比例的升高而增加自身在群体中的比例，即选择搭载效应。搭载效应过后，中性突变的积累同样会造成额外的低比例的变异。

### mismatch distribution
在序列两两比较看差异位点数量的时候，=使用全部数据，看其分布情况
![example3](https://pic1.zhimg.com/80/v2-4bba8997e80daaa5000a1179acaa5674_720w.jpg)
在群体数量恒定，无选择压力的中性条件下，不匹配分布通常是双峰分布。

### 关联位点
正向选择-- 一个受到自然选择的位点除了其本身频率变化之外，与之关联的中性位点也会或多或少受到影响。

但这种对于核酸多态性的选择取决于重组率，这也就证明了线粒体核酸多态性低的原因

**background selection**如果受选择的突变是一个有害变异，那么在自然选择的作用下，该变异在群体中频率会降低直至消失。同样因为和这些有害位点关联，周围中性位点的多态性也会受到影响，对周围中性位点的影响称之为“背景选择”背景选择也会导致群体的多态性降低。

平衡选择:不使得某一位点固定或者消失，而是保持多态性长期维持

## phage
28 10 softmax 80%
cart 84% 3level and we can find the specific indicators maybe 3 or 4

# 2018-8-18
## PLAN
+ **阅读Gao论文**
+ **西瓜书chapter 6**
+ **Gre 阅读2 填空 1**
+ **群体遗传总结回顾**
+ **phage 继续利用神经网络探究**

## SVM总结
+ KKT条件
+ SOM算法
+ 损失函数
+ SVC
+ 核函数

## 群体遗传part
+ 基因频率、基因型频率、杂合衡量和D

# 2018-8-19
## PLAN
+ **阅读Gao论文**
+ 西瓜书chapter 7
+ **Gre 阅读3**
+ **群体遗传总结回顾**
+ **phage 继续利用神经网络探究**

## 500-bp phage result
### random forest
84.5%
### deep learning
78.5%

## Gaoxin ARG论文
ARG序列识别，用卷积神经网络CNN识别
包括抗菌性 mechanism source
cross-entropy losses
三层方式减少计算量

## 群体遗传中最关键的描述因素
### $H$ $F$ and $H_e$
对于杂合性的描述十分重要
inbreeding depression 近交衰退
### 配子不平衡
理想情况下两个配子AB的组合为的概率为$p_Ap_B$
**影响因素**

+ 物理连锁 和重组有关
+ 自然选择 和选择系数有关s
+ 变异 与变异率有关 即通过不同模型包括产生新基因，互相突变等
+ 不同群体之间的合并 可以通过基因流中群体结构进行解释
+ 交配系统不同 如近交

# 2018-8-20
## PLAN
+ **西瓜书chapter 7**
+ **QTL初步**
+ **Gre阅读2**
+ **深度学习理论学习 CNN RNN**
+ **群体遗传回顾**

## NTU Lab
https://www.ntu.edu.sg/sbs/research/research-directory/melissa-jane-fullwood#Content_C004_Col00


## QTL初步
构建形状的量化和基因数的关系
工具R包中qtl工具

## 群体遗传回顾
Drift概念
一些数学模型WR模型，马尔可夫，分支过程模型
瓶颈效应(一开始有效群体数量小，难以快速增加)，建立者效应（大规模灭绝会让有效群体数量难以恢复）
溯祖概率，时间...

key point 固定时间 $\frac{1}{2p}N_e$