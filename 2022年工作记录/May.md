- [2022-5-4](#2022-5-4)
  - [PLAN](#plan)
  - [拟南芥年龄分布](#%E6%8B%9F%E5%8D%97%E8%8A%A5%E5%B9%B4%E9%BE%84%E5%88%86%E5%B8%83)
  - [de perturbation](#de-perturbation)
- [2022-5-5](#2022-5-5)
  - [PLAN](#plan-1)
  - [网络拓扑问题](#%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91%E9%97%AE%E9%A2%98)
- [2022-5-6](#2022-5-6)
  - [PLAN](#plan-2)
- [2022-5-7](#2022-5-7)
  - [PLAN](#plan-3)
  - [预测数据分析](#%E9%A2%84%E6%B5%8B%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90)
  - [转座子活性](#%E8%BD%AC%E5%BA%A7%E5%AD%90%E6%B4%BB%E6%80%A7)
- [2022-5-8](#2022-5-8)
  - [PLAN](#plan-4)
  - [解决](#%E8%A7%A3%E5%86%B3)
  - [信息](#%E4%BF%A1%E6%81%AF)
- [2022-5-9](#2022-5-9)
  - [PLAN](#plan-5)
  - [空间转录组](#%E7%A9%BA%E9%97%B4%E8%BD%AC%E5%BD%95%E7%BB%84)
    - [技术](#%E6%8A%80%E6%9C%AF)
- [2022-5-10](#2022-5-10)
  - [PLAN](#plan-6)
  - [1135文献](#1135%E6%96%87%E7%8C%AE)
    - [1135 测序](#1135-%E6%B5%8B%E5%BA%8F)
    - [RNA-seq/甲基化](#rna-seq%E7%94%B2%E5%9F%BA%E5%8C%96)
  - [蛋白质生成表示](#%E8%9B%8B%E7%99%BD%E8%B4%A8%E7%94%9F%E6%88%90%E8%A1%A8%E7%A4%BA)
- [2022-5-11](#2022-5-11)
  - [PLAN](#plan-7)
  - [tf2tf 层数修改](#tf2tf-%E5%B1%82%E6%95%B0%E4%BF%AE%E6%94%B9)
- [2022-5-14](#2022-5-14)
  - [PLAN](#plan-8)
  - [网络拓扑](#%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91)
    - [此前情况](#%E6%AD%A4%E5%89%8D%E6%83%85%E5%86%B5)
    - [解决](#%E8%A7%A3%E5%86%B3-1)
- [2022-5-15](#2022-5-15)
  - [PLAN](#plan-9)
  - [单细胞训练训练步骤](#%E5%8D%95%E7%BB%86%E8%83%9E%E8%AE%AD%E7%BB%83%E8%AE%AD%E7%BB%83%E6%AD%A5%E9%AA%A4)
  - [minimap2](#minimap2)
- [2022-5-16](#2022-5-16)
  - [PLAN](#plan-10)
  - [拟南芥空间转录组](#%E6%8B%9F%E5%8D%97%E8%8A%A5%E7%A9%BA%E9%97%B4%E8%BD%AC%E5%BD%95%E7%BB%84)
    - [验证](#%E9%AA%8C%E8%AF%81)
    - [应用](#%E5%BA%94%E7%94%A8)
  - [模型修改结果](#%E6%A8%A1%E5%9E%8B%E4%BF%AE%E6%94%B9%E7%BB%93%E6%9E%9C)
  - [NGS 学习](#ngs-%E5%AD%A6%E4%B9%A0)
    - [SRA 命令](#sra-%E5%91%BD%E4%BB%A4)
    - [bwa 命令](#bwa-%E5%91%BD%E4%BB%A4)
- [2022-5-17](#2022-5-17)
  - [PLAN](#plan-11)
  - [NGS](#ngs)
    - [Pair](#pair)
    - [处理](#%E5%A4%84%E7%90%86)
  - [单细胞网络分析](#%E5%8D%95%E7%BB%86%E8%83%9E%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90)
- [2022-5-22](#2022-5-22)
  - [PLAN](#plan-12)
  - [单细胞模型改进](#%E5%8D%95%E7%BB%86%E8%83%9E%E6%A8%A1%E5%9E%8B%E6%94%B9%E8%BF%9B)
  - [BBMap](#bbmap)
- [2022-5-23](#2022-5-23)
  - [PLAN](#plan-13)
  - [双端测序](#%E5%8F%8C%E7%AB%AF%E6%B5%8B%E5%BA%8F)
  - [WGS 步骤](#wgs-%E6%AD%A5%E9%AA%A4)
- [2022-5-24](#2022-5-24)
  - [PLAN](#plan-14)
  - [大肠杆菌拼接](#%E5%A4%A7%E8%82%A0%E6%9D%86%E8%8F%8C%E6%8B%BC%E6%8E%A5)
    - [数据下载](#%E6%95%B0%E6%8D%AE%E4%B8%8B%E8%BD%BD)
    - [质控](#%E8%B4%A8%E6%8E%A7)
  - [单细胞模型修改](#%E5%8D%95%E7%BB%86%E8%83%9E%E6%A8%A1%E5%9E%8B%E4%BF%AE%E6%94%B9)
- [2022-5-25](#2022-5-25)
  - [PLAN](#plan-15)
  - [GATK](#gatk)
    - [MarkDuplicates](#markduplicates)
- [2022-5-26](#2022-5-26)
  - [PLAN](#plan-16)
  - [单细胞可视化](#%E5%8D%95%E7%BB%86%E8%83%9E%E5%8F%AF%E8%A7%86%E5%8C%96)
  - [GATK](#gatk-1)
    - [为参考序列生成一个.dict文件](#%E4%B8%BA%E5%8F%82%E8%80%83%E5%BA%8F%E5%88%97%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AAdict%E6%96%87%E4%BB%B6)
    - [生成中间文件gvcf](#%E7%94%9F%E6%88%90%E4%B8%AD%E9%97%B4%E6%96%87%E4%BB%B6gvcf)
    - [通过gvcf检测变异](#%E9%80%9A%E8%BF%87gvcf%E6%A3%80%E6%B5%8B%E5%8F%98%E5%BC%82)
  - [文献阅读](#%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB)
- [2022-5-27](#2022-5-27)
  - [PLAN](#plan-17)
  - [minimap2 代码](#minimap2-%E4%BB%A3%E7%A0%81)
  - [VCF及$F_{st}$](#vcf%E5%8F%8Afst)
    - [VCF Merge](#vcf-merge)
    - [Fst 问题](#fst-%E9%97%AE%E9%A2%98)
    - [NUCLEOTIDE DIVERGENCE](#nucleotide-divergence)

# 2022-5-4

## PLAN
+ **研究年龄分布**
+ **单细胞新模型**

## 拟南芥年龄分布

需要利用总长度做矫正,k 为每个核苷酸替换概率 distance/length

## de perturbation

出现了推过量的问题


# 2022-5-5

## PLAN

+ **网络拓扑检测**


## 网络拓扑问题

+ decoder训练没有加两个loss
+ mask rate调整

# 2022-5-6

## PLAN
+ **单细胞结果可视化**
+ **文献阅读**
+ **文件签字**
+ **relict 研究**


# 2022-5-7

## PLAN

+ **整理预测数据**
+ **文献阅读**

## 预测数据分析

v1 v2 push程度较大，但在gene-wise不明显，可以考虑修改umap降维参数

## 转座子活性

利用snp低频偏移以及转座子拷贝数做分析


# 2022-5-8

## PLAN

+ **单细胞原始数据分析**
+ **继续做不同mask rate调优**

## 解决

+ 堆叠层数
+ thredhold 分别不同

## 信息

Hongxu Ding, PhD

Assistant Professor, Translational Pharmacogenomics

Department of Pharmacy Practice and Science, University of Arizona

Drachman Hall B207N

Email: hongxuding@arizona.edu

Tel: 520-626-5764


Email: hongxuding@arizona.edu

Tel: 520-626-5764
Brian Erstad, PharmD

https://www.pharmacy.arizona.edu/

Roy P. Drachmann Hall
Pulido Center – Tucson
1295 N. Martin
PO Box 210202
Tucson, AZ 85721
Phone: 520-626-1427

$5500

19901130

丁鸿绪

SSN 722349266

# 2022-5-9

## PLAN

+ **空间转录组工作**
+ **修改perturbation 函数**

## 空间转录组

### 技术

+ DNB DNA纳米球上CID 进入到chip的每一个孔中，进行测序
+ 再将CID umi与切片结合
+ 二次进行sc-RNA测序时通过CID定位



# 2022-5-10

## PLAN
+ **蛋白生成模型**
+ **SRA fastaq**

## 1135文献

### 1135 测序

pipeline
+ 测fastq
+ QC
+ 生成VCF (没拼接)

同时利用allpath 做assemble了

### RNA-seq/甲基化

甲基化pipeline


+ 测序两次
  + trim
  + 去接头
  + botie

## 蛋白质生成表示

提出了一种变分自编码模型，但其特点为蛋白质已进行one-hot编码，因此其loss有较大不同，同时提出了不同的蛋白距离计算。另一个特点为可以模拟进化树结构

问题 模型十分复杂，不知道是否可以重参数化

# 2022-5-11

## PLAN
+ **毕业设计ppt**
+ **修改tf2tf 层数**

## tf2tf 层数修改

在de perturbation上有很大进展但是没法在tf perturbation上有进展

# 2022-5-14

## PLAN
+ **网络拓扑分析**
+ **进化树文章框架**
+ minimap2

## 网络拓扑

### 此前情况

有一定的推动，但是缺少可视化的结果，是否观察特定基因？

### 解决
问题在于两个网络的权值很小，一般都在0.08左右，有点不够大，因此调低了一些正则化参数

# 2022-5-15

## PLAN
+ **单细胞训练**
+ **minimap2算法**

## 单细胞训练训练步骤
+ Encoder Pretrain
+ Decoder Pretrain 1000 epochwes
+ Decoder mask
+ Decoder 网络中parameters*10
+ 微调
+ VAE微调



## minimap2

minimizer 找到{x,y,w} x 为ref 位置, y为query 位置 w为interval
找到一系列的anchers
最后可以确定位置

+ 首先，将基因组序列的minimizer存储在哈希表中（minimizer指一段序列内最小哈希值的种子）；
+ 然后，对于每一条待比对序列，找到待比对序列所有的minimizer，通过哈希表找出其在基因组中的位置，并利用chaining算法寻找待比对区域；
+ 最后，将非种子区域用动态规划算法进行比对得到比对结果。

# 2022-5-16

## PLAN
+ **单细胞修改模型可视化**
+ **拟南芥空间转录组**
+ **bwa 学习**


## 拟南芥空间转录组


### 验证

有空间数据子群识别以及收集更多转录本，同时找到更多标记鞇

### 应用

+ 细胞分形
+ 不同区域的基因表达关系
+ 不同区域的分化

## 模型修改结果

+ P_MEP,P_GMP(3000/5002) 恢复基因数显著多于 未恢复
+ 但在图上无法可视化

## NGS 学习

### SRA 命令

```bash
fastq-dump --split-3 --defline-qual '+' --defline-seq '@\$ac-\$si/\$ri'  SRR1945478 --gzip
```

下载压缩的双端测序数据

### bwa 命令

```bash
# bwa index -a bwtsw Col-0.fasta
bwa mem /home/ubuntu/data/NGS/Col-0.fasta /home/ubuntu/data/NGS/Col-0.fasta /home/ubuntu/data/NGS/SRR390728.fastq > /home/ubuntu/data/NGS/result/bwa_result.sam
```
+ 建立索引
+ 进行比对

# 2022-5-17

## PLAN

+ **NGS数据摸索**
+ **单细胞网络分析**

## NGS

可以map上，但目前在考虑双端的问题，不知道是否需要QC

### Pair

主要原因在于Illumina的二代测序仪的读长短，相对于第一代sanger测序法（约1000bp）或者跟同属于NGS的其他测序仪相比短了许多。因此illumina发展了 Paired-end的建库测序技术。同时这种技术还大大推进了基因组学数据分析的发展。
例如，依赖于Paired-end的技术，假设一个DNA片段刚好跨越了重复序列区域（下图左侧）以及独特序列区域（下图右侧）。

### 处理

使用bbmap做处理

## 单细胞网络分析

decoder 恢复效果不好，同时第二层Z太差

# 2022-5-22

## PLAN
+ **毕业设计文件整理**
+ **单细胞模型**


## 单细胞模型改进

将权值在mask后均匀初始化为0 1 变量进行训练

## BBMap

已下载但作用不大，需要进一步调试

# 2022-5-23

## PLAN
+ **WGS 配对学习**

## 双端测序

WGS 问题推测可能是下载过程中出现问题，可以通过大肠杆菌的数据进行处理

## WGS 步骤
 
**推荐指导流程 https://zhuanlan.zhihu.com/p/335770966**

+ 原始数据指控
+ reads 比对 （BWA）
+ Indel 区域
+ 碱基质量矫正
+ 变异检测

# 2022-5-24

## PLAN
+ 大肠杆菌WGS组装
+ 单细胞模型修改

## 大肠杆菌拼接

### 数据下载

```bash
## 下载并index参考基因组
curl -C - -O ftp://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/005/845/GCF_000005845.2_ASM584v2/GCF_000005845.2_ASM584v2_genomic.fna.gz
bgzip -dc GCF_000005845.2_ASM584v2_genomic.fna.gz > E.coli_K12_MG1655.fa
samtools faidx E.coli_K12_MG1655.fa

## 下载WGS文件
/home/ubuntu/data/softwares/sratoolkit.2.11.2-ubuntu64/bin/fastq-dump --split-files SRR1770413

## fastq 文件

/home/ubuntu/data/softwares/sratoolkit.2.11.2-ubuntu64/bin/fastq-dump --split-files SRR1770413
bgzip -f SRR1770413_1.fastq
bgzip -f SRR1770413_2.fastq
```

### 质控

**代码**

```bash
fastp \
-i SRR1770413_1.fastq.gz \
-o SRR1770413_1.clean.fastq.gz \
-I SRR1770413_2.fastq.gz \
-O SRR1770413_2.clean.fastq.gz \
-z 4 \
-f 5 -t 5 -F 5 -T 5 \
-5 -W 5 -M 20 \
-Q \
-l 50 \
-c \
-w 4
```

```markdown
# 参数说明
# 1. I/O options   即输入输出文件设置
## -i, --in1    输入read1文件名  
## -o, --out1   输出read1文件名  
## -I, --in2    输入read2文件名  
## -O, --out2   输出read2文件名  
## -z, --compression    输出压缩格式。给定一个数字1-9，调整压缩比率和效率的平衡  

# 2. adapter trimming options   过滤序列接头参数设置  
## -A, --disable_adapter_trimming    默认已开启，设置该参数则关闭  

# 3. global trimming options   剪除序列起始和末端的低质量碱基数量参数  
## -f,--trim_front1  
## -t, --trim_tail1  
## -F, --trim_front2  
## -T, --trim_tail2  

# 4. per read cutting by quality options   划窗裁剪  
## 具体的原理就是通过滑动一定长度的窗口，计算窗口内的碱基平均质量，如果过低，就直接往后全部切除。  
### 不是挖掉read中的这部分低质量序列，像切菜一样，直接从低质量区域开始把这条read后面的所有其它碱基全！部！剁！掉！否则就是在人为改变实际的基因组序列情况。  
## -5, --cut_by_quality5  
## -3, --cut_by_quality3  
## -W, --cut_window_size    设置窗口大小  
## -M, --cut_mean_quality    设置窗口碱基平均质量阈值  

# 5. quality filtering options   根据碱基质量来过滤序列  
## -Q, --disable_quality_filtering    控制是否去除低质量，默认自动去除，设置-Q关闭  
## -q, --qualified_quality_phred    设置低质量的标准，默认Q15  
## -u, --unqualified_percent_limit    低质量碱基所占百分比，默认40代表40%  

# 6. length filtering options   根据序列长度来过滤序列  
## -l, --length_required    设规定read被切除后至少需要保留的长度，如果低于该长度，会被丢掉  

# 7. base correction by overlap analysis options   通过overlap来校正碱基  
## -c, --correction    是对overlap的区域进行纠错，只适用于pairend reads  

# 8. threading options   设置线程数  
## -w, --thread 设置线程数
```

**原理**

质控分析包括

+ read各个位置的碱基质量值分布
好的结果是碱基质量值都基本都在大于30，而且波动很小。
+ 碱基的总体质量值分布
对于二代测序，最好是达到Q20的碱基要在95%以上(最差不低于90%)，Q30要求大于85%(最差也不要低于80%)。
+ read各个位置上碱基分布比例，目的是为了分析碱基的分离程度
最好平均在1%以内。
+ GC含量分布
对于人类来说，我们基因组的GC含量一般在40%左右。
+ read各位置的N含量
N在测序数据中一般是不应该出现的。
+ read是否还包含测序的接头序列
在测序之前需要构建测序文库，测序接头就是在这个时候加上的，其目的一方面是为了能够结合到flowcell上，另一方面是当有多个样本同时测序的时候能够利用接头信息进行区分。一般的WGS测序是不会测到这些接头序列的。
+ read重复率，这个是实验的扩增过程所引入的

**WGS质控与RNA-seq不同**

## 单细胞模型修改

权重*2 效果变好

# 2022-5-25

## PLAN

+ **GATK 学习使用+原理+文献**
+ **单细胞结果可视**

## GATK

GATK全称是The Genome Analysis Toolkit，是Broad Institute（The Broad Institute, formerly the Broad Institute of MIT and Harvard, evolved from a decade of research collaborations among MIT and Harvard scientists.）开发的用于二代重测序数据分析的一款软件，里面包含了很多有用的工具，主要注重与变异的查找，基因分型且对于数据质量保证高度重视。

### MarkDuplicates

标记PCR重复

原理

+ PCR扩增原本的目的就是为了增大微弱DNA序列片段的密度，但由于整个反应都在一个试管中进行，因此其他一些密度并不低的DNA片段也会被同步放大，在取样上机时，这些DNA片段就很可能被重复取到相同的几条去进行测序。最直接的后果就是同时增大了变异检测结果的假阴和假阳率。

gatk的MarkDuplicates模块来实现PCR重复功能，即只把重复序列在输出的新结果中标记出来，但不删除。

代码

```bash
gatk MarkDuplicates \
-I E_coli_K12.sorted.bam \
-O E_coli_K12.sorted.markdup.bam \
-M E_coli_K12.sorted.markdup_metrics.txt
```

# 2022-5-26

## PLAN

+ **文献阅读**
+ **NGS组装 samtools**
+ **单细胞可视化**

## 单细胞可视化

推动 两个转录因子 可以影响 4个转录因子

推动一个转录因子 可以影响两个转录因子


## GATK

### 为参考序列生成一个.dict文件

**代码**
```bash
gatk CreateSequenceDictionary \
-R Col-0.fasta \
-O Col-0.dict
```

### 生成中间文件gvcf

**代码**
```bash
gatk HaplotypeCaller \
-R Col-0.fasta \
--emit-ref-confidence GVCF \
-I Ath.sorted.markdup.bam \
-O Ath.g.vcf
```

### 通过gvcf检测变异

**代码**
```bash
gatk HaplotypeCaller \
-R Col-0.fasta \
-I Ath.sorted.markdup.bam \
-O Ath.vcf.gz
```

通过gatk检测出变异后，可以进行过滤或进一步操作。

## 文献阅读

利用scRNA-seq作为参考构建VAE模型。空间转录组组作为输入利用VAE模型，提取embedding ，判断每个spot中子状态，以及其他特性。

# 2022-5-27

## PLAN
+ **单细胞结果汇总作图**
+ **计算$F_{st}$脚本检查**
+ **minimap 使用**

## minimap2 代码

```bash
# 建立索引
minimap2 -d Col-0.min  Col-0.fasta
# 比对
minimap2 -x sr -a  Col-0.min  SRR390728_1.fastq.gz \
                        SRR390728_2.fastq.gz > test.sam
```

注意的问题是需要调整参数 sr (short read)

## VCF及$F_{st}$

### VCF Merge

merge后会出现 一个sample有这个图片另一个sample没有的问题，即在中间出现. 可能会影响divergency的问题...

### Fst 问题

出现$H_t$=0的问题，会计算出nan，可以提前做filter`vcftools --min-allels`?

### NUCLEOTIDE DIVERGENCE

利用`vcftools --site-pi`计算核酸多样性
