- [2022-3-1](#2022-3-1)
  - [PLAN](#plan)
  - [机器学习基础](#%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80)
    - [数据结构](#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84)
    - [预处理](#%E9%A2%84%E5%A4%84%E7%90%86)
    - [优化算法](#%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95)
- [2022-3-5](#2022-3-5)
  - [PLAN](#plan-1)
  - [拟南芥项目逻辑](#%E6%8B%9F%E5%8D%97%E8%8A%A5%E9%A1%B9%E7%9B%AE%E9%80%BB%E8%BE%91)
  - [大修文章](#%E5%A4%A7%E4%BF%AE%E6%96%87%E7%AB%A0)
- [2022-3-6](#2022-3-6)
  - [PLAN](#plan-2)
  - [NODE](#node)
  - [PSMC MSMC](#psmc-msmc)
- [2022-3-7](#2022-3-7)
  - [PLAN](#plan-3)
  - [单细胞数据迁移](#%E5%8D%95%E7%BB%86%E8%83%9E%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB)
  - [Ryan Gutenkunst Research](#ryan-gutenkunst-research)
    - [分子间相互作用](#%E5%88%86%E5%AD%90%E9%97%B4%E7%9B%B8%E4%BA%92%E4%BD%9C%E7%94%A8)
    - [联合AFS推断新突变的适应度效应分布（DFE）](#%E8%81%94%E5%90%88afs%E6%8E%A8%E6%96%AD%E6%96%B0%E7%AA%81%E5%8F%98%E7%9A%84%E9%80%82%E5%BA%94%E5%BA%A6%E6%95%88%E5%BA%94%E5%88%86%E5%B8%83dfe)
- [2022-3-8](#2022-3-8)
  - [PLAN](#plan-4)
  - [单细胞数据迁移训练](#%E5%8D%95%E7%BB%86%E8%83%9E%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E8%AE%AD%E7%BB%83)
    - [GPU问题](#gpu%E9%97%AE%E9%A2%98)
    - [预训练问题](#%E9%A2%84%E8%AE%AD%E7%BB%83%E9%97%AE%E9%A2%98)
- [2022-3-9](#2022-3-9)
  - [PLAN](#plan-5)
  - [单细胞tf 预训练](#%E5%8D%95%E7%BB%86%E8%83%9Etf-%E9%A2%84%E8%AE%AD%E7%BB%83)
    - [无kld](#%E6%97%A0kld)
    - [有kld](#%E6%9C%89kld)
  - [拟南芥基因组缩小原因](#%E6%8B%9F%E5%8D%97%E8%8A%A5%E5%9F%BA%E5%9B%A0%E7%BB%84%E7%BC%A9%E5%B0%8F%E5%8E%9F%E5%9B%A0)
  - [meta - learning](#meta---learning)
- [2022-3-10](#2022-3-10)
  - [PLAN](#plan-6)
  - [毕业设计文献综述](#%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1%E6%96%87%E7%8C%AE%E7%BB%BC%E8%BF%B0)
  - [meta-learning](#meta-learning)
    - [分类](#%E5%88%86%E7%B1%BB)
    - [数据准备](#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87)
- [2022-3-11](#2022-3-11)
  - [PLAN](#plan-7)
  - [meta-learning学习整理](#meta-learning%E5%AD%A6%E4%B9%A0%E6%95%B4%E7%90%86)
    - [Overview](#overview)
    - [Matching](#matching)
    - [MAML](#maml)
  - [单细胞](#%E5%8D%95%E7%BB%86%E8%83%9E)
    - [均值恢复不好的原因](#%E5%9D%87%E5%80%BC%E6%81%A2%E5%A4%8D%E4%B8%8D%E5%A5%BD%E7%9A%84%E5%8E%9F%E5%9B%A0)
- [2022-3-12](#2022-3-12)
  - [PLAN](#plan-8)
  - [单细胞预训练](#%E5%8D%95%E7%BB%86%E8%83%9E%E9%A2%84%E8%AE%AD%E7%BB%83)
    - [GENE2TF](#gene2tf)
    - [TF2GENE](#tf2gene)
- [2022-3-13](#2022-3-13)
  - [PLAN](#plan-9)
  - [权值预训练](#%E6%9D%83%E5%80%BC%E9%A2%84%E8%AE%AD%E7%BB%83)
- [2022-3-14](#2022-3-14)
  - [PLAN](#plan-10)
  - [拟南芥数据处理](#%E6%8B%9F%E5%8D%97%E8%8A%A5%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86)
    - [下载代码更新](#%E4%B8%8B%E8%BD%BD%E4%BB%A3%E7%A0%81%E6%9B%B4%E6%96%B0)
  - [mask 代码](#mask-%E4%BB%A3%E7%A0%81)
  - [单细胞药学开发](#%E5%8D%95%E7%BB%86%E8%83%9E%E8%8D%AF%E5%AD%A6%E5%BC%80%E5%8F%91)
    - [应用](#%E5%BA%94%E7%94%A8)
    - [耐药性研究](#%E8%80%90%E8%8D%AF%E6%80%A7%E7%A0%94%E7%A9%B6)
    - [迁移学习](#%E8%BF%81%E7%A7%BB%E5%AD%A6%E4%B9%A0)
- [2022-3-15](#2022-3-15)
  - [PLAN](#plan-11)
  - [成果收集](#%E6%88%90%E6%9E%9C%E6%94%B6%E9%9B%86)
- [2022-3-16](#2022-3-16)
  - [PLAN](#plan-12)
  - [下载代码步骤](#%E4%B8%8B%E8%BD%BD%E4%BB%A3%E7%A0%81%E6%AD%A5%E9%AA%A4)
- [2022-3-17](#2022-3-17)
  - [PLAN](#plan-13)
  - [单细胞代码](#%E5%8D%95%E7%BB%86%E8%83%9E%E4%BB%A3%E7%A0%81)
    - [Encoder Pretrain](#encoder-pretrain)
    - [latent space注意顺序](#latent-space%E6%B3%A8%E6%84%8F%E9%A1%BA%E5%BA%8F)
- [2022-3-18](#2022-3-18)
  - [PLAN](#plan-14)
  - [TE重构代码](#te%E9%87%8D%E6%9E%84%E4%BB%A3%E7%A0%81)
- [2022-3-19](#2022-3-19)
  - [PLAN](#plan-15)
  - [单细胞工作设计](#%E5%8D%95%E7%BB%86%E8%83%9E%E5%B7%A5%E4%BD%9C%E8%AE%BE%E8%AE%A1)
- [2022-3-19](#2022-3-19-1)
  - [PLAN](#plan-16)
  - [权值](#%E6%9D%83%E5%80%BC)


# 2022-3-1

## PLAN
+ **深度学习基础理论学习**
+ 陆老师文献综述

## 机器学习基础

### 数据结构

N-维数据

+ 0维数组 浮点数
+ 1-d [1.0,2.7,3.4] 一个样本
+ 2-d 特征矩阵 多个样本
+ 3-d RGB图片 宽、高、通道
+ 4-d 一个batch的图片

[1:3,:] 1 2 行 [1,3)

dim = 0 按行合并 向下堆 [3,4] [3,4] [6,4]
dim = 1 按列合并 向又加

### 预处理

用 readcsv 读

处理缺失 插值法

```py
inputs = inputs.fillna(inputs.mean())
```

### 优化算法

+ 小批量梯度下降 随机梯度下降 比 梯度下降慢 加大批量时随机梯度下降比较快
+ 冲量法 使用平滑过的梯度进行更新 
+ Adam 做了很多的平滑 对学习率不敏感


# 2022-3-5

## PLAN

+ **拟南芥甲基化文献讲解**
+ **毕业设计文献翻译1**
+ **大修文章创建修改稿**


## 拟南芥项目逻辑

+ 拟南芥的基因组大小不同
+ 原因是转座子有关
+ 转座子活性和甲基化有关
+ G4和甲基化
+ 环境影响G4折叠 影响甲基化

全基因组大小 TE序列的数量 TE序列的bp 活性TE家族数 TE序列/基因组序列 G4数量 G4被甲基化的数量 $\frac{G4中甲基化的bp/G4的bp}{全基因组甲基化的bp/全基因组大小}$

## 大修文章

差一个major review问题和 R2的minor review问题


# 2022-3-6

## PLAN

+ **大修文章完成R2minor修改**
+ **文献阅读**
+ **深度学习微分方程**


## NODE

深度学习解微分方程原理利用神经网络模拟差分过程

## PSMC MSMC

利用隐马尔可夫模型估计有效群体大小

为第三类问题即参数估计问题

在转移概率计算中变异重组有效群体都可以计算

# 2022-3-7

## PLAN

+ **单细胞数据迁移**
+ **大修GitHub文件整理**
+ **Ryan Gutenkunst Research**

## 单细胞数据迁移

**目前问题**

+ GPU显存不够
+ 计算的GPU和CPU区分

## Ryan Gutenkunst Research

### 分子间相互作用

动力学/调控网络

### 联合AFS推断新突变的适应度效应分布（DFE）

# 2022-3-8

## PLAN

+ **大修文章cover letter 定稿**
+ **单细胞数据迁移训练**

## 单细胞数据迁移训练

### GPU问题

使用 SGD进行优化更加节省内存

### 预训练问题

+ 多个组预训练效果不好，尝试下单个组预训练
+ 修改下beta权重

# 2022-3-9

## PLAN

+ **单细胞 加入kld 预训练**
+ **文献阅读**
+ **meta - learning**

## 单细胞tf 预训练

### 无kld
不同类型细胞tf恢复相关性不同

### 有kld

开始版本可能训练不充分

## 拟南芥基因组缩小原因

拟南芥基因组的缩小取决于基因组的失活或者TE Elimination

## meta - learning

overview 学习相似任务的共性

# 2022-3-10

## PLAN

+ **毕业设计文献综述**
+ **csbj投稿**
+ **微生物投稿**
+ **meta-learning**

## 毕业设计文献综述

包括了病毒基因组的部分以及NLP进展部分

## meta-learning

### 分类

+ 按照参数学习能力 同输入不同输出的学习 同输出不同情况输入的任务学习等  
+ 按照学习约束 找到不同任务的共同约束

### 数据准备

外层 训练 测试 验证
内层 训练 测试

外层中每一个数据集都包含内层的两种数据集即6种

如元训练集 每个任务 包含N分类每个分类下有K个样本的数据集作为训练集，包含N分类每个分类下有K个样本的数据集作为训练集，剩余样本作为测试集

其他两个外层相同

# 2022-3-11

## PLAN

+ **meta learning 学习**
+ **单细胞工作整理**
+ **微生物投稿**

## meta-learning学习整理

### Overview

+ pre-train
+ FSL few-shot learn

### Matching

特征向量cos 相似度


### MAML

多任务找到比较好的$\hat{\theta}$,以便让测试任务中每一个任务都能迭代到好结果。

## 单细胞

### 均值恢复不好的原因

可能分类就不够明确，导致均值不一定能复现

# 2022-3-12

## PLAN

+ **毕设文件整理**
+ **单细胞预训练**


## 单细胞预训练

### GENE2TF

相关性大约在0.4-0.6 beta=0.05

### TF2GENE

相关性0.8以上

# 2022-3-13

## PLAN

+ **毕业设计中期整理**
+ **预训练权值研究**

## 权值预训练

```py
from functools import reduce
from pickle import load
import torch
import numpy as np
import torch.nn.functional as F
from torch import  nn, optim
import scanpy as sc
from scipy import sparse
import pandas as pd
import Custom_dataLoader
import VAE_model
from torch.utils.data import DataLoader
from early_stop import EarlyStopping
model = torch.load("/home/ubuntu/MLPackageStudy/VAE/in-silico/model_Version_2/decoder_human_checkpoint.pt",map_location="cpu")
model
z2tf = 0
for name,parameters in model.named_parameters():
    if name.startswith("z2tf2.fc_layers.Layer 0.0.weight"):
        print(name,':',parameters)
        z2tf = parameters
torch.argmax(torch.abs(z2tf))
_, idx1 = torch.sort(torch.abs(z2tf).reshape(-1), descending=False)#descending为alse，升序，为True，降序
idx = idx1[:int(z2tf.shape[0]*z2tf.shape[1]*0.5)]
z2tf.view(-1)[idx]
```

进一步参考vega代码进行mask进一步操作

```py
def create_pathway_mask(feature_list, dict_pathway, add_missing=1, fully_connected=True, to_tensor=False):
    """
    Creates a mask of shape [genes,pathways] where (i,j) = 1 if gene i is in pathway j, 0 else.

    Expects a list of genes and pathway dict.
    Note: dict_pathway should be an Ordered dict so that the ordering can be later interpreted.

    Args:
        feature_list (list): List of genes in single-cell dataset.
        dict_pathway (OrderedDict): Dictionary of gene_module:genes.
        add_missing (int): Number of additional, fully connected nodes.
        fully_connected (bool): Whether to fully connect additional nodes or not.
        to_tensor (False): Whether to convert mask to tensor or not.
    Returns:
        torch.tensor/np.array: Gene module mask.
    """
    assert type(dict_pathway) == OrderedDict
    p_mask = np.zeros((len(feature_list), len(dict_pathway)))
    for j, k in enumerate(dict_pathway.keys()):
        for i in range(p_mask.shape[0]):
            if feature_list[i] in dict_pathway[k]:
                p_mask[i,j] = 1.
    if add_missing:
        n = 1 if type(add_missing)==bool else add_missing
        # Get non connected genes
        if not fully_connected:
            idx_0 = np.where(np.sum(p_mask, axis=1)==0)
            vec = np.zeros((p_mask.shape[0],n))
            vec[idx_0,:] = 1.
        else:
            vec = np.ones((p_mask.shape[0], n))
        p_mask = np.hstack((p_mask, vec))
    if to_tensor:
        p_mask = torch.Tensor(p_mask)
    return p_mask
```

创建mask矩阵 tf_mask [ i, j ] = 1 如果他们的关系够大 否则为0


# 2022-3-14

## PLAN

+ **完成mask 函数**
+ **拟南芥数据预处理**
+ **文献阅读**

## 拟南芥数据处理

```r

###### 数据预处理 #####··1  1                                                                                                                                                           
data <-read.table(file="/home/ubuntu/Arabidopsis/Scripts/datasetA.csv", header=TRUE, sep=",")
data$G4_MC_rate_bp
data <- data[,c(-1)]
colnames(data)[1] <- 'Num'


accessions_altitude <-read.table(file="/home/ubuntu/Arabidopsis/accessions-altitude.csv", header=FALSE, sep=",")
accessions_altitude <- accessions_altitude[,c(-5,-9,-10,-12,-13,-14)]
names(accessions_altitude) <- c("Num", "Platform", "Name","Nation","Lat","Long","Altitude","Group")
accessions_altitude$Altitude = as.numeric(accessions_altitude$Altitude)

library(dplyr)
data_join = inner_join(data,accessions_altitude,by="Num")


##### 相关性分析#####
plot(data_join$Altitude, data_join$sequence.bp,   col = "blue",
     abline(lm(data_join$sequence.bp~data_join$Lat)),cex = 1.3,pch = 16)
accessions_altitude <- accessions_altitude[,c(-9,-12,-13,-14)]


(data$G4_MC_rate_bp~data$sequence.bp)
cor(data_join$Lat, data_join$sequence.bp,method="pearson")
ggplot(data_join[which(data_join$Group=="relict"),],aes(x=sequence.bp,y=G4_MC_rate))+ geom_point(size=1,shape=15)+geom_smooth(method=lm)


#### 不同组的参数对比

boxplot(data_join$G4_MC_rate~data_join$Group)
boxplot(data_join$sequence.bp~data_join$Group)
boxplot(data_join$G4_total_bp~data_join$Group,ylim=c(9e+4,1.1e+5))
boxplot(data_join$Altitude~data_join$Group)







##### relict#####

relict = data_join[which(data_join$Group=="relict"),]
cor(relict$Lat, relict$sequence.bp,method="pearson")
cor(relict$Long, relict$sequence.bp,method="pearson")
cor(relict$Altitude, relict$sequence.bp,method="pearson")
cor(relict$sequence.bp,relict$G4_total,method="pearson")
cor(relict$sequence.bp,relict$G4_MC_rate_bp,method="pearson")
cor(relict$sequence.bp,relict$G4_MC_rate,method="pearson")
ggplot(relict,aes(x=sequence.bp,y=G4_MC_rate_bp))+ geom_point(size=1,shape=15)+geom_smooth(method=lm)
```

### 下载代码更新

```bash
ascp -i ~/.aspera/connect/etc/asperaweb_id_dsa.openssh -l 100M -k 1 -T anonftp@ftp.ncbi.nlm.nih.gov:/geo/samples/GSM2099nnn/GSM2099214/suppl/GSM2099214_allc_6201.tsv.gz ~/data/softwares

```
https://blog.csdn.net/weshengxin/article/details/110118398
## mask 代码

```py
### 一旦有了全部的id 即可
tf_mask = torch.ones(z2tf.shape[0]*z2tf.shape[0])
tf_mask [idx] = 0
# torch.sum(tf_mask) , z2tf.shape[0]*z2tf.shape[0]/2
tf_mask = tf_mask.reshape(z2tf.shape[0],z2tf.shape[0])
```

## 单细胞药学开发

### 应用
        

找到drug target关系利用单细胞转录组可以保存细胞异质性的特点
Bulk在一个组织上直接多个细胞测转录组


### 耐药性研究

对于肿瘤细胞，可能车消除一类细胞后会出现残留细胞主导疾病的现象，因此需要保留细胞异质性信息

对t细胞受体进行单细胞测序可以以好物帮助的活T细胞

### 迁移学习

Bulk转录组测序后做预训练再做做微调


# 2022-3-15

## PLAN

+ **毕业设计图片翻译及成果收集**
+ **单细胞finetune**


## 成果收集

+ /home/ubuntu/project/phage-classifer/layers.py 神经网络架构
+ /home/ubuntu/project/phage-classifer/initial_data.py 数据预处理
+ /home/ubuntu/project/phage-classifer/course_final.py 特征识别


# 2022-3-16

## PLAN
+ **完善下载代码**
+** 修改单细胞训练代码**

## 下载代码步骤

+ 打开tmux
+ `source /etc/bashrc`
+ 下载


# 2022-3-17

## PLAN

+ **修改单细胞mask代码**

## 单细胞代码

### Encoder Pretrain

最新模型 cor 达到0.4-0.7之间

### latent space注意顺序

错误原因:由Adata处发生

# 2022-3-18

## PLAN

+ **单细胞整理后可视化**
+ **TE重构代码**

## TE重构代码

利用paralle 和 相关参数的设定在LTR_FINDER_parallel中修改参数


# 2022-3-19

## PLAN
+ 单细胞工作设计

## 单细胞工作设计

+ 拿出decoder 的权重 做可视化
+ 跑新的benchmark以及perturbation
  + 研究此前benchmark的R代码
  + 输出特定格式

# 2022-3-19

## PLAN
+ 文献阅读
+ **权值调控网络可视化**

## 权值

还需解决如何构建网络的问题

**GRN调控网络学习**